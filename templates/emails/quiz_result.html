<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Result</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif; background-color: #f3f4f6;">
    <table role="presentation" style="width: 100%; border-collapse: collapse; background-color: #f3f4f6;">
        <tr>
            <td style="padding: 40px 20px;">
                <!-- Main Container -->
                <table role="presentation" style="max-width: 100%; margin: 0 auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">

                    <!-- Header -->
                    <tr>
                        <td style="background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); padding: 25px; text-align: center; border-radius: 8px 8px 0 0;">
                            <h1 style="margin: 0; color: #ffffff; font-size: 22px; font-weight: 600; letter-spacing: 0.3px;">Quiz Result Notification</h1>
                            <p style="margin: 8px 0 0 0; color: #dbeafe; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Quiz App - Educational Platform</p>
                        </td>
                    </tr>

                    <!-- Greeting -->
                    <tr>
                        <td style="padding: 25px 30px;">
                            <p style="margin: 0 0 15px 0; font-size: 13px; color: #374151; line-height: 1.5;">
                                <strong>Dear {{ user_name }},</strong>
                            </p>
                            <p style="margin: 0 0 15px 0; font-size: 13px; color: #4b5563; line-height: 1.6;">
                                Thank you for completing your quiz. Below is a comprehensive summary of your performance and results.
                            </p>
                        </td>
                    </tr>

                    <!-- Score Card -->
                    <tr>
                        <td style="padding: 0 30px 25px 30px;">
                            <table role="presentation" style="width: 100%; border-collapse: collapse; background-color: {% if passed %}#f0fdf4{% else %}#fef2f2{% endif %}; border-radius: 6px; border: 1px solid {% if passed %}#86efac{% else %}#fca5a5{% endif %};">
                                <tr>
                                    <td style="padding: 20px; text-align: center;">
                                        <h2 style="margin: 0 0 12px 0; font-size: 15px; color: #1f2937; font-weight: 600;">{{ quiz_title }}</h2>

                                        <!-- Score Badge -->
                                        <div style="margin: 12px 0;">
                                            <span style="display: inline-block; background-color: {% if passed %}#10b981{% else %}#ef4444{% endif %}; color: #ffffff; font-size: 32px; font-weight: 700; padding: 12px 28px; border-radius: 50px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); line-height: 1.2;">
                                                {{ "%.1f"|format(score) }}%
                                            </span>
                                        </div>

                                        <p style="margin: 12px 0 5px 0; font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
                                            <strong>Attempt {{ attempt_number }} of 3</strong>
                                        </p>

                                        <!-- Pass/Fail Message -->
                                        <p style="margin: 10px 0 0 0; font-size: 13px; font-weight: 600; color: {% if passed %}#059669{% else %}#dc2626{% endif %};">
                                            {% if passed %}
                                            Congratulations! You have passed this quiz.
                                            {% else %}
                                            {% if attempt_number < 3 %}You have {{ 3 - attempt_number }} more attempt(s) remaining.{% else %}All attempts have been used.{% endif %}
                                            {% endif %}
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Quiz Summary -->
                    <tr>
                        <td style="padding: 0 30px 25px 30px;">
                            <h3 style="margin: 0 0 12px 0; font-size: 15px; color: #1f2937; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; font-weight: 600;">
                                Performance Summary
                            </h3>
                            <table role="presentation" style="width: 100%; border-collapse: collapse; background-color: #f9fafb; padding: 15px; border-radius: 4px;">
                                <tr>
                                    <td style="padding: 6px 10px; font-size: 12px; color: #4b5563;">
                                        <strong>Total Questions:</strong>
                                    </td>
                                    <td style="padding: 6px 10px; font-size: 12px; color: #1f2937; text-align: right; font-weight: 600;">
                                        {{ total_questions }}
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 6px 10px; font-size: 12px; color: #4b5563;">
                                        <strong>Correct Answers:</strong>
                                    </td>
                                    <td style="padding: 6px 10px; font-size: 12px; color: #10b981; text-align: right; font-weight: 700;">
                                        {{ correct_count }}
                                    </td>
                                </tr>
                                {% if results.fill_in_the_blanks %}
                                <tr style="border-top: 1px solid #e5e7eb;">
                                    <td style="padding: 6px 10px 6px 20px; font-size: 11px; color: #6b7280;">
                                        Fill in the Blanks
                                    </td>
                                    <td style="padding: 6px 10px; font-size: 11px; color: #374151; text-align: right;">
                                        {% set fib_correct = results.fill_in_the_blanks|selectattr('is_correct')|list|length %}
                                        {{ fib_correct }}/{{ results.fill_in_the_blanks|length }}
                                    </td>
                                </tr>
                                {% endif %}
                                {% if results.true_false %}
                                <tr style="border-top: 1px solid #e5e7eb;">
                                    <td style="padding: 6px 10px 6px 20px; font-size: 11px; color: #6b7280;">
                                        True/False
                                    </td>
                                    <td style="padding: 6px 10px; font-size: 11px; color: #374151; text-align: right;">
                                        {% set tf_correct = results.true_false|selectattr('is_correct')|list|length %}
                                        {{ tf_correct }}/{{ results.true_false|length }}
                                    </td>
                                </tr>
                                {% endif %}
                                {% if results.mcqs %}
                                <tr style="border-top: 1px solid #e5e7eb;">
                                    <td style="padding: 6px 10px 6px 20px; font-size: 11px; color: #6b7280;">
                                        Multiple Choice
                                    </td>
                                    <td style="padding: 6px 10px; font-size: 11px; color: #374151; text-align: right;">
                                        {% set mcq_correct = results.mcqs|selectattr('is_correct')|list|length %}
                                        {{ mcq_correct }}/{{ results.mcqs|length }}
                                    </td>
                                </tr>
                                {% endif %}
                            </table>
                        </td>
                    </tr>

                    <!-- Your Answers Section -->
                    <tr>
                        <td style="padding: 0 30px 25px 30px;">
                            <h3 style="margin: 0 0 12px 0; font-size: 15px; color: #1f2937; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; font-weight: 600;">
                                Detailed Answer Review
                            </h3>

                            <!-- Fill in the Blanks -->
                            {% if results.fill_in_the_blanks %}
                            <div style="margin: 15px 0 20px 0; padding: 10px 12px; background-color: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 3px;">
                                <h4 style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600;">Fill in the Blanks</h4>
                            </div>
                            {% for item in results.fill_in_the_blanks %}
                            <div style="margin-bottom: 12px; padding: 10px; background-color: #fafafa; border-left: 2px solid {% if item.is_correct %}#10b981{% else %}#ef4444{% endif %}; border-radius: 3px;">
                                <p style="margin: 0 0 6px 0; font-size: 12px; color: #374151; font-weight: 600; line-height: 1.5;">
                                    Question {{ loop.index }}: {{ item.question }}
                                </p>
                                <p style="margin: 0 0 4px 0; font-size: 11px; color: {% if item.is_correct %}#059669{% else %}#dc2626{% endif %}; line-height: 1.4;">
                                    <strong>Your Answer:</strong> {{ item.user_answer if item.user_answer else "(Not answered)" }}
                                </p>
                                {% if not item.is_correct %}
                                <p style="margin: 0; font-size: 11px; color: #059669; line-height: 1.4;">
                                    <strong>Correct Answer:</strong> {{ item.correct_answer }}
                                </p>
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% endif %}

                            <!-- True/False -->
                            {% if results.true_false %}
                            <div style="margin: 15px 0 20px 0; padding: 10px 12px; background-color: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 3px;">
                                <h4 style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600;">True/False</h4>
                            </div>
                            {% for item in results.true_false %}
                            <div style="margin-bottom: 12px; padding: 10px; background-color: #fafafa; border-left: 2px solid {% if item.is_correct %}#10b981{% else %}#ef4444{% endif %}; border-radius: 3px;">
                                <p style="margin: 0 0 6px 0; font-size: 12px; color: #374151; font-weight: 600; line-height: 1.5;">
                                    Question {{ loop.index }}: {{ item.question }}
                                </p>
                                {% if item.is_correct %}
                                <p style="margin: 0; font-size: 11px; color: #059669; line-height: 1.4;">
                                    <strong>{{ "True" if item.correct_answer else "False" }}</strong> - Correct
                                </p>
                                {% else %}
                                <p style="margin: 0 0 4px 0; font-size: 11px; color: #dc2626; line-height: 1.4;">
                                    <strong>Your Answer:</strong> {{ "True" if item.user_answer else "False" }}
                                </p>
                                <p style="margin: 0; font-size: 11px; color: #059669; line-height: 1.4;">
                                    <strong>Correct Answer:</strong> {{ "True" if item.correct_answer else "False" }}
                                </p>
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% endif %}

                            <!-- Multiple Choice -->
                            {% if results.mcqs %}
                            <div style="margin: 15px 0 20px 0; padding: 10px 12px; background-color: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 3px;">
                                <h4 style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600;">Multiple Choice</h4>
                            </div>
                            {% for item in results.mcqs %}
                            <div style="margin-bottom: 12px; padding: 10px; background-color: #fafafa; border-left: 2px solid {% if item.is_correct %}#10b981{% else %}#ef4444{% endif %}; border-radius: 3px;">
                                <p style="margin: 0 0 8px 0; font-size: 12px; color: #374151; font-weight: 600; line-height: 1.5;">
                                    Question {{ loop.index }}: {{ item.question }}
                                </p>
                                {% if item.is_correct %}
                                <p style="margin: 0; padding: 6px; background-color: #d1fae5; border-radius: 3px; font-size: 11px; color: #065f46; font-weight: 600;">
                                    {{ item.correct_answer }} ✓
                                </p>
                                {% else %}
                                {% for option in item.options %}
                                <p style="margin: 4px 0; padding: 5px 8px; {% if option == item.correct_answer %}background-color: #d1fae5; border: 1px solid #10b981;{% elif option == item.user_answer %}background-color: #fee2e2; border: 1px solid #ef4444;{% else %}background-color: #ffffff; border: 1px solid #e5e7eb;{% endif %} border-radius: 3px; font-size: 11px; line-height: 1.4;">
                                    {{ option }}
                                    {% if option == item.correct_answer %}<strong style="color: #059669; font-size: 10px;"> ✓ CORRECT</strong>{% endif %}
                                    {% if option == item.user_answer and not item.is_correct %}<strong style="color: #dc2626; font-size: 10px;"> YOUR ANSWER</strong>{% endif %}
                                </p>
                                {% endfor %}
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% endif %}
                        </td>
                    </tr>

                    <!-- CTA Button -->
                    <tr>
                        <td style="padding: 0 30px 25px 30px; text-align: center;">
                            <a href="{{ base_url }}/user/result/{{ result_id }}" style="display: inline-block; background-color: #1e40af; color: #ffffff; text-decoration: none; padding: 12px 35px; border-radius: 6px; font-size: 13px; font-weight: 600; box-shadow: 0 2px 4px rgba(30, 64, 175, 0.25); letter-spacing: 0.3px;">
                                View Full Results Online
                            </a>
                            <p style="margin: 12px 0 0 0; font-size: 11px; color: #6b7280; line-height: 1.4;">
                                Access your complete quiz results and performance analytics
                            </p>
                        </td>
                    </tr>

                    <!-- Submission Info -->
                    <tr>
                        <td style="padding: 0 30px 20px 30px; text-align: center;">
                            <p style="margin: 0; font-size: 11px; color: #9ca3af; line-height: 1.4;">
                                <strong style="color: #6b7280;">Submitted:</strong> {{ timestamp }}
                            </p>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #f9fafb; padding: 18px 30px; border-radius: 0 0 8px 8px; border-top: 1px solid #e5e7eb;">
                            <p style="margin: 0 0 8px 0; font-size: 11px; color: #4b5563; text-align: center; line-height: 1.5;">
                                This is an automated email notification. Please do not reply to this message.
                            </p>
                            <p style="margin: 0; font-size: 10px; color: #9ca3af; text-align: center;">
                                &copy; 2025 Quiz App - Educational Platform
                            </p>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>
